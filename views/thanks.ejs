<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thank You!</title>
</head>
<body>
    <div class="header">
        <button class="button" onclick="openModal()">Contact Us</button>
        <h1>Mekoski Fundraiser</h1>
        <button class="button" onclick="window.location.href='/';">Home</button>
    </div>

     <!-- Modal for Contact Us -->
     <div id="contactModal" class="modal">
        <div class="modal-content">
            <span  tabindex="0"  class="close" onclick="closeModal()">&times;</span>
            <h2>Contact Us</h2>
            <p>Email: <a href="mailto:hgn.shelly@yahoo.com?subject=Terry Mekoski Wine Fundraiser">hgn.shelly@yahoo.com</a></p>
        </div>
    </div>

    <div class="content">
        <p>Thank you for supporting Terence Mekoski!</p>

        <% if (id) { %>
            <p>Your ticket purchase ID is: <span id="id"><%= id %></span></p>
            <div id="info"></div>
            <p>This information has also been sent to the email address you provided.</p>
        <% } else { %>
            <p>Please provide a valid ticket purchase ID.</p>
        <% } %>

    </div>

    <script>
        // Check if the ID element is not empty
        const idElement = document.getElementById('id');
        if (idElement && idElement.textContent.trim() !== '') {
            const uuid = idElement.textContent; // Get the UUID from the span

            // Fetch data from the /getInfo route
            fetch(`/getInfo`, {
                method: 'POST', // Use POST since you need to send data
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ uuid }), // Send UUID as JSON
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json(); // Parse JSON response
            })
            .then(data => {
                // Create a table to display the results
                const table = document.createElement('table');
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = `<th>Name</th><th>Email</th><th>Phone</th>`;
                table.appendChild(headerRow);

                // Populate the table with the returned rows
                data.forEach(row => {
                    const rowElement = document.createElement('tr');
                    rowElement.innerHTML = `<td>${row.name}</td><td>${row.email}</td><td>${row.phone}</td>`;
                    table.appendChild(rowElement);
                });

                // Append the table to the info div
                document.getElementById('info').appendChild(table);
            })
            .catch(error => {
                console.error('Error fetching ticket information:', error);
                document.getElementById('info').innerText = 'Failed to retrieve ticket information.';
            });
        }

        function openModal() {
        document.getElementById("contactModal").style.display = "block";
    }

    function closeModal() {
        document.getElementById("contactModal").style.display = "none";
        // document.getElementById('paypal-button-container').style.height='0px'
    }

    // Update the Contact Us button to call openModal()
    document.querySelector('.header .button').onclick = openModal;

     // Close modal when clicking outside of it
     window.onclick = function(event) {
        const modal = document.getElementById("contactModal");
        if (event.target === modal) {
            closeModal();
        }
    }

    </script>
</body>
</html>